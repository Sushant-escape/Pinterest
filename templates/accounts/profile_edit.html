{% extends 'base.html' %}

{% block content %}
<div class="container" style="max-width: 650px; margin: 40px auto;">
    <div class="modal-card" style="max-width: 100%; padding: 40px;">
        <div class="modal-header">
            <h3>Edit Profile</h3>
        </div>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-group" style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    <i class="fas fa-user"></i> Username
                </label>
                <input type="text" value="{{ user.username }}" disabled
                    style="width: 100%; padding: 12px 16px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; background: #f5f5f5;">
                <small style="color: #999; display: block; margin-top: 5px;">Username cannot be changed</small>
            </div>

            <div class="form-row"
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                        First Name
                    </label>
                    <input type="text" name="first_name" value="{{ user.first_name }}"
                        style="width: 100%; padding: 12px 16px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px;">
                </div>

                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                        Last Name
                    </label>
                    <input type="text" name="last_name" value="{{ user.last_name }}"
                        style="width: 100%; padding: 12px 16px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px;">
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    <i class="fas fa-envelope"></i> Email
                </label>
                <input type="email" value="{{ user.email }}" disabled
                    style="width: 100%; padding: 12px 16px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; background: #f5f5f5;">
                <small style="color: #999; display: block; margin-top: 5px;">Email cannot be changed</small>
            </div>

            <div class="form-group" style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    <i class="fas fa-align-left"></i> Bio
                </label>
                <textarea name="bio" rows="4"
                    style="width: 100%; padding: 12px 16px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; font-family: inherit; resize: vertical;">{{ user.bio }}</textarea>
            </div>

            <div class="form-group" style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    <i class="fas fa-globe"></i> Website
                </label>
                <input type="url" name="website" value="{{ user.website }}" placeholder="https://example.com"
                    style="width: 100%; padding: 12px 16px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px;">
            </div>

            <div class="form-group" style="margin-bottom: 30px;">
                <label style="display: block; margin-bottom: 12px; font-weight: 700; color: #111;">
                    <i class="fas fa-camera"></i> Profile Image
                </label>
                <div style="display: flex; align-items: center; gap: 24px; margin-bottom: 20px;">
                    <div id="imagePreviewContainer">
                        {% if user.profile_image %}
                        <img src="{{ user.profile_image.url }}" id="profilePreview"
                            style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #f0f0f0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        {% else %}
                        <div id="profilePreviewPlaceholder"
                            style="width: 120px; height: 120px; border-radius: 50%; background: #efefef; display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: 800; color: #767676; border: 4px solid #f0f0f0;">
                            {{ user.username.0|upper }}
                        </div>
                        {% endif %}
                    </div>
                    <div style="flex: 1;">
                        <input type="file" name="profile_image" id="profileImageInput" accept="image/*"
                            style="display: none;">
                        <button type="button" onclick="document.getElementById('profileImageInput').click()"
                            class="btn-gray" style="display: inline-flex; align-items: center; gap: 8px;">
                            <i class="fas fa-upload"></i> Choose New Photo
                        </button>
                        <p style="margin-top: 8px; font-size: 14px; color: #767676;">JPG, PNG or GIF. Max size 2MB.</p>
                    </div>
                </div>
            </div>

            <script>
                document.getElementById('profileImageInput').onchange = function (evt) {
                    const [file] = this.files;
                    if (file) {
                        const preview = document.getElementById('profilePreview');
                        const placeholder = document.getElementById('profilePreviewPlaceholder');
                        const newImageUrl = URL.createObjectURL(file);

                        if (preview) {
                            preview.src = newImageUrl;
                        } else if (placeholder) {
                            // Create a new image element to replace the placeholder
                            const img = document.createElement('img');
                            img.id = 'profilePreview';
                            img.src = newImageUrl;
                            img.setAttribute('style', 'width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #f0f0f0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);');
                            placeholder.parentNode.replaceChild(img, placeholder);
                        }
                    }
                };
            </script>

            <div class="form-actions" style="display: flex; flex-direction: column; gap: 16px; margin-top: 32px;">
                <div style="display: flex; gap: 12px;">
                    <button type="submit" class="btn-primary" style="flex: 2;">Save Changes</button>
                    <a href="{% url 'accounts:profile' %}" class="btn-secondary" style="flex: 1;">Cancel</a>
                </div>

                <div style="border-top: 1px solid #efefef; padding-top: 24px; text-align: center;">
                    <a href="{% url 'accounts:profile_delete' %}"
                        style="color: var(--primary-red); font-weight: 700; font-size: 14px;">
                        Delete account
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

{% endblock %}